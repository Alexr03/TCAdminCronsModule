@using System.Web.Mvc.Html
@using Alexr03.Common.Misc.Strings
@using Kendo.Mvc.UI
@using TCAdmin.SDK.Web.MVC.Extensions
@using TCAdminCrons.Models.Objects
@{
    Layout = this.GetTemplateFile("Shared/Main.cshtml", true);
}

@section sidebar{
    @Html.Partial("_DefaultSidebar")
}

@(Html.Kendo().TabStrip()
    .Name("tabstrip")
    .Items(items =>
    {
        foreach (var cronJob in CronJob.GetCronJobs().Where(cron => cron.Configuration.HasView()))
        {
            items.Add().Text(cronJob.Create().GetType().Name.SplitEveryCapital()).LoadContentFrom("ConfigureCron", "Crons", new {id = cronJob.Id});
        }
    })
    .SelectedIndex(0)
    .TabPosition(TabStripTabPosition.Left)
    )
    
<script>
    function runNow(id){
        $.ajax({
            type: "POST",
            url: "/Crons/RunCronNow/",
            data: JSON.stringify({ "id": id }),
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            error: function (e) {
                console.log(e);
            },
            success: function (e) {
                console.log(e);
                TCAdmin.Ajax.ShowUrlDialog("Run Cron Job", e.url, function(e){}, 1600, 600);
            }
        });
    }
</script>